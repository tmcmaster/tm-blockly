<link rel="import" href="blockly.html">

<!--
`tm-blockly`
Polymer web component to encapsulate the Blockly workbench.

@demo demo/tm-blockly-demo.html
-->
<dom-module id="tm-blockly-workbench">
  <template>
    <style>
      :host {
        display: inline-block;
        width:1200px;
        border:solid green 3px;
      }
      #blocklyArea { width:100%;height:100%; }
      #blocklyDiv { height:100%; position: absolute; }
    </style>

    <div id="blocklyArea"></div>
    <div id="blocklyDiv"></div>

    <content id="toolbox" select="xml.toolbox"></content>
  </template>

  <script>
    (function(Blockly) {
      Polymer({
        is: 'tm-blockly-workbench',
        properties: {
          prop1: {
            type: String,
            value: 'tm-blockly'
          },
        },
        getCode: function() {
          return Blockly.JavaScript.workspaceToCode(this.workspace);
        },
        ready: function() {
          var blocklyArea = this.$.blocklyArea;
          var blocklyDiv = this.$.blocklyDiv;
          var toolbox = this.getContentChildren('#toolbox')[0];
          var media = '../blockly/media/';
          this.workspace = Blockly.inject(blocklyDiv,{media:media,toolbox:toolbox});
          var self = this;
          setTimeout(function() {
            var onresize = function(e) {
              var element = blocklyArea;
              var x = 0;
              var y = 0;
              do {
                x += element.offsetLeft;
                y += element.offsetTop;
                element = element.offsetParent;
              } while (element);
              blocklyDiv.style.left = x + 'px';
              blocklyDiv.style.top = y + 'px';
              blocklyDiv.style.width = blocklyArea.offsetWidth + 'px';
              blocklyDiv.style.height = blocklyArea.offsetHeight + 'px';
            };
            window.addEventListener('resize', onresize, false);
            onresize();
            Blockly.svgResize(self.workspace);
          },100);
        }
      });
    })(Blockly);
  </script>
</dom-module>
